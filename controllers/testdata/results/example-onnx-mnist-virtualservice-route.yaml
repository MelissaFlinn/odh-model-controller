apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
    name: example-onnx-mnist
    namespace: ns-dssnm
    labels:
        inferenceservice-name: example-onnx-mnist
spec:
  gateways:
  - opendatahub/odh-gateway
  hosts:
  - '*'
  http:
  - match:
    - method:
        exact: POST
      headers:
        content-type:
          prefix: application/grpc
        mm-vmodel-id:
          exact: example-onnx-mnist
    route:
    - destination:
        host: modelmesh-serving.ns-dssnm.svc.cluster.local
        port:
          number: 8033
  - match:
    - uri:
        exact: /modelmesh/ns-dssnm/v2/models/example-onnx-mnist/infer
    rewrite:
      uri: /v2/models/example-onnx-mnist/infer
    route:
    - destination:
        host: modelmesh-serving.ns-dssnm.svc.cluster.local
        port:
          number: 8008